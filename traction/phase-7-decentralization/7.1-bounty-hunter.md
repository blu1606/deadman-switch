# 7.1 Bounty Hunter Protocol

> "Your vault is triggered by market incentives, not admin goodwill."

## ğŸ¯ Goal
Make `trigger_release` permissionless. Anyone can call it after deadline â†’ gets small bounty.

## ğŸ“ How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CLASSIC CHECK-IN + BOUNTY                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  [CREATED] â†’ Timer starts                           â”‚
â”‚      â”‚                                              â”‚
â”‚      â”‚ â† Owner/Delegate pings (resets timer)        â”‚
â”‚      â–¼                                              â”‚
â”‚  [EXPIRED] â†’ deadline passed, no ping               â”‚
â”‚      â”‚                                              â”‚
â”‚      â”‚ Anyone calls trigger_release()               â”‚
â”‚      â”‚ â†’ Gets bounty (0.01-0.05 SOL)                â”‚
â”‚      â–¼                                              â”‚
â”‚  [RELEASED]                                         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Contract Changes

### 1. Update Vault Struct
```rust
pub struct Vault {
    // ... existing fields ...
    pub bounty_lamports: u64,  // NEW: Bounty for hunter
}
```

### 2. Update `initialize_vault`
```rust
pub fn initialize_vault(
    ctx: Context<InitializeVault>,
    // ... existing params ...
    bounty_lamports: u64,  // NEW: Optional bounty
) -> Result<()> {
    // Transfer bounty from user to vault PDA
    vault.bounty_lamports = bounty_lamports;
}
```

### 3. Modify `trigger_release`
```rust
#[derive(Accounts)]
pub struct TriggerRelease<'info> {
    #[account(mut)]
    pub vault: Account<'info, Vault>,
    
    #[account(mut)]
    pub hunter: Signer<'info>,  // Anyone - no constraint
    
    pub system_program: Program<'info, System>,
}

pub fn trigger_release(ctx: Context<TriggerRelease>) -> Result<()> {
    let vault = &mut ctx.accounts.vault;
    let clock = Clock::get()?;
    
    // Check expired
    let deadline = vault.last_check_in + vault.check_in_interval;
    require!(clock.unix_timestamp > deadline, VaultError::NotExpired);
    require!(!vault.is_released, VaultError::AlreadyReleased);
    
    // Pay bounty to hunter
    if vault.bounty_lamports > 0 {
        **vault.to_account_info().try_borrow_mut_lamports()? -= vault.bounty_lamports;
        **ctx.accounts.hunter.try_borrow_mut_lamports()? += vault.bounty_lamports;
    }
    
    vault.is_released = true;
    vault.bounty_lamports = 0;
    
    Ok(())
}
```

## ğŸª¦ Gravedigger SDK (Community Bot)

> "Let the community earn money by keeping the system alive."

### Concept
Open-source script (~50 LOC) that anyone can run to:
1. Monitor expired vaults
2. Auto-trigger release
3. Collect bounty

### Script Template
```javascript
// gravedigger.js
const { Connection, PublicKey } = require('@solana/web3.js');
const { Program } = require('@coral-xyz/anchor');

const PROGRAM_ID = 'HnFEhMS84CabpztHCDdGGN8798NtXW4aG17XpB';

async function hunt() {
  const connection = new Connection(process.env.RPC_URL);
  
  // Get all vault accounts
  const vaults = await connection.getProgramAccounts(new PublicKey(PROGRAM_ID));
  
  for (const vault of vaults) {
    const data = parseVaultData(vault.account.data);
    const now = Date.now() / 1000;
    const deadline = data.lastCheckIn + data.checkInInterval;
    
    if (now > deadline && !data.isReleased && data.bounty > 0) {
      console.log(`ğŸ’€ Found expired vault: ${vault.pubkey}`);
      console.log(`   Bounty: ${data.bounty / 1e9} SOL`);
      
      await triggerRelease(vault.pubkey);
      console.log(`   âœ… Claimed!`);
    }
  }
}

// Run every 5 minutes
setInterval(hunt, 5 * 60 * 1000);
hunt();
```

### Exec Steps
- [x] Add `bounty_lamports` to Vault struct âœ… Already in `state.rs`
- [x] Update `initialize_vault` and `trigger_release` âœ… Already implemented
- [x] Gravedigger SDK âœ… `scripts/gravedigger.ts`
- [ ] Remove Vercel Cron â†’ Optional (can keep as backup)

---

## âœ… Implementation Status: COMPLETE

### Contract Files
- `state.rs`: `bounty_lamports: u64` field
- `trigger_release.rs`: Permissionless, pays bounty to hunter

### Frontend Files
- `StepConfirm.tsx`: Bounty slider in create wizard (0.001 SOL default)
- `VaultCard.tsx`: Displays bounty amount
- `TopUpBountyModal.tsx`: Top-up existing bounty

### SDK
- `scripts/gravedigger.ts`: Full bounty hunter bot

### Usage
```bash
# Run Gravedigger
export RPC_URL=https://api.devnet.solana.com
export PRIVATE_KEY=<base58_wallet_key>
npx ts-node scripts/gravedigger.ts
```

