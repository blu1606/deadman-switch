# 13.2 Bundle & Render Optimization

> **Goal:** Smooth 60fps UI and faster Initial Paint  
> **Techniques:** Dynamic Imports, `useTransition`, `next/script`

---

## ðŸŽ¯ Problem Analysis

**Issues:**
1.  **Heavy Initial Load:** `WalletAdapter` and `VaultSafe3D` (Three.js/Framer) are large libraries loaded upfront.
2.  **UI Blocking:** Tab switching in Dashboard causes "jank" (React renders blocking main thread).

**Target:**
- **Lighthouse Score:** 95+ Performance.
- **Interaction to Next Paint (INP):** < 200ms.

---

## ðŸ› ï¸ Implementation Plan

### 1. Lazy Loading Components

**VaultSafe3D (Heavy Visuals):**
Only needed when "Claim" modal opens or on Landing page view.

```tsx
import dynamic from 'next/dynamic';

const VaultSafe3D = dynamic(
  () => import('@/components/claim/VaultSafe3D'),
  { 
    loading: () => <div className="h-52 w-52 bg-slate-800 rounded-xl animate-pulse" />,
    ssr: false // No need to SSR 3D canvas
  }
);
```

**Wallet Modal:**
Often heavy (@solana/web3.js). Ensure it's not blocking FCP. (Next.js handles this well usually, but check imports).

### 2. Non-Blocking Transitions (`useTransition`)

When switching Vaults or Tabs in Dashboard:

```tsx
import { useTransition } from 'react';

function DashboardTabs({ onChange }) {
  const [isPending, startTransition] = useTransition();

  const handleTabChange = (newTab) => {
    startTransition(() => {
      onChange(newTab); // Low priority update
    });
  };

  return (
    <div style={{ opacity: isPending ? 0.7 : 1 }}>
      {/* Tabs... */}
    </div>
  );
}
```
**Effect:** The "Tab Click" feels instant (button highlights), even if the content takes 100ms to render.

### 3. Font Optimization
Ensure `next/font` is used correctly with `swap` strategy to avoid FOIT (Flash of Invisible Text).

### 4. Bundle Analysis
Run `npm run build` with `@next/bundle-analyzer` to spot accidental heavy imports (e.g. importing full `lodash` instead of `lodash/debounce`).

---

## âœ… Checklist

- [ ] Wrap `VaultSafe3D` with `dynamic()`
- [ ] Identify other heavy components (Confetti, Graphs) > `dynamic()`
- [ ] Implement `useTransition` for Dashboard filtering/tabs
- [ ] Check `next/font` config
- [ ] Verify build size < 200KB First Load JS

