# 13.3 Performance Fixes (CSS & Animation)

> **Goal:** Reduce bundle size and repaint cost by unifying CSS tokens and optimizing keyframe animations.  
> **Target:** `src/app/globals.css`, `tailwind.config.ts`.

---

## ðŸ“ Design & Strategy

### 1. Token Unification (CSS variables)
Currently, `globals.css` defines custom variables (`--bg-primary`, `--color-alive`) that duplicate Shadcn/Tailwind logic.
We will consolidate these into the **Tailwind Config** and **Shadcn** `hsl` system.

| Legacy Var | New Token / Class | Value |
|------------|-------------------|-------|
| `--bg-primary` | `bg-void-black` / `bg-dark-950` | `#020617` |
| `--bg-surface` | `bg-slate-900` / `bg-dark-900` | `#0F172A` |
| `--color-alive` | `text-safe-green` | `#10B981` |
| `--text-primary` | `text-signal-white` | `#F8FAFC` |

### 2. Animation Optimization (GPU Acceleration)
Replcase `box-shadow` animations (expensive Paint) with `opacity` animations on pseudo-elements (GPU Composite).

**Target:** `.btn-alive` (Pulse effect)
**Change:**
- **From:** Animate `box-shadow` directly.
- **To:** Add `::after` element with `inset-0`, `rounded-xl`, `bg-emerald-500`. Animate `opacity` and `transform: scale()` of this pseudoelement.

---

## ðŸ› ï¸ Implementation Steps

### Step 1: Clean `tailwind.config.ts`
- Ensure `void-black`, `safe-green`, etc. are strictly defined.
- Remove any redundant custom definitions if they exist in Shadcn `tokens`.

### Step 2: Refactor `globals.css`
1.  **Delete** the top-level `:root` block (Lines 9-30).
2.  **Find & Replace** standard usages:
    - Replace `var(--bg-primary)` â†’ `theme('colors.void-black')`.
    - Replace `var(--bg-surface)` â†’ `theme('colors.slate.900')`.
3.  **Refactor `.btn-alive`:**
    ```css
    .btn-alive {
      @apply relative isolate overflow-hidden;
      /* ... static styles ... */
    }
    .btn-alive::after {
      content: '';
      @apply absolute inset-0 -z-10 rounded-xl bg-emerald-500;
      animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse-ring {
      0% { transform: scale(1); opacity: 0.5; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    ```

### Step 3: Global Search/Replace
- Scan `.tsx` files for inline styles or classes referencing the old variable names (unlikely with Tailwind, but check).

---

## âœ… Verification Plan

### Manual Verification
1.  **Dashboard UI:** Check if the "Alive" button still pulses correctly.
2.  **Dark Mode:** Ensure background colors are consistent (no flash of white/wrong black).
3.  **DevTools:** Use "Rendering" tab -> "Paint Flashing" to confirm `btn-alive` no longer triggers full repaints on every frame.
